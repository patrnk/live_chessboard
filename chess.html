<!DOCTYPE html>
<html>
    <head>
    </head>
    <body>
        <input type="file" id="game_file"/>
        <br>
        <button id="next_turn_button" disabled>Следующий ход</button>
        <br>
        <label id="turn_description"></label>
        <script>
            var coordinates = []
            var next_turn_button = document.getElementById("next_turn_button");
            var control = document.getElementById("game_file");
            var turn_description = document.getElementById("turn_description");
            var current_turn = 0;

            var convert_cell_to_coordinates = function(turn) {
                // левый верхний угол A8 -> (0,0).
                // (см. chessboard.jpg)
                var letter_number_map = {
                    'A': 0, 'B': 1, 'C': 2, 'D': 3,
                    'E': 4, 'F': 5, 'G': 6
                }
                var column_letter = turn[0];
                var reversed_row = parseInt(turn[1]);
                var column = letter_number_map[column_letter];
                var row = (reversed_row - 8) * (-1);
                return {'row': row, 'col': column};
            }

            var display_next_turn = function() {
                if (current_turn >= coordinates.length) {
                    turn_description.innerText = "Ходы закончились";
                    next_turn_button.disabled = true;
                    return;
                }
                start_row = coordinates[current_turn]["start"]["row"];
                start_col = coordinates[current_turn]["start"]["col"];
                finish_row = coordinates[current_turn]["finish"]["row"];
                finish_col = coordinates[current_turn]["finish"]["col"];
                turn_description.innerText = "(" + start_row + "," + start_col + ")" +
                    " -> (" + finish_row + "," + finish_col + ")";
                current_turn += 1;
            }

            var reader = new FileReader();
            reader.onload = function(event) {
                var contents = event.target.result;
                var turns = contents.split("\n"); // ожидается, что каждый новый ход на новой строке
                console.log("Ходы: " + turns);
                for (var i = 0; i < turns.length; i++) {
                    if (!turns[i]) {
                        // Если строка пустая или undefined, пропускаем итерацию
                        continue;
                    }
                    var start_cell = turns[i].split(" ")[0];
                    var finish_cell = turns[i].split(" ")[1];
                    var start_coordinates = convert_cell_to_coordinates(start_cell);
                    var finish_coordinates = convert_cell_to_coordinates(finish_cell);
                    coordinates.push({"start": start_coordinates, "finish": finish_coordinates})
                }
                next_turn_button.disabled = false;
                current_turn = 0;
                display_next_turn();
            }

            next_turn_button.onclick = function(event) {
                display_next_turn();
            }

            var read_file = function(event) {
                var files = control.files;
                var file = files[0]; // гарантированно будет ровно один
                reader.readAsText(file);
            }
            control.addEventListener("change", read_file, false);
        </script>
    </body>
</html>
